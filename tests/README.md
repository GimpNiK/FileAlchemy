# Тесты для FileAlchemy

Этот каталог содержит полный набор тестов для библиотеки FileAlchemy.

## Структура тестов

### Базовые модули
- `test_encoding_utils.py` - тесты для определения кодировок и BOM
- `test_file_utils.py` - тесты для утилит работы с файлами
- `test_stream_and_file.py` - тесты для потоков и файлов
- `test_dir.py` - тесты для работы с директориями

### Архивы
- `test_archive_extra.py` - расширенные тесты для архивов
- `test_archive_edge_cases.py` - граничные случаи и особые сценарии
- `test_archive_performance.py` - тесты производительности

### Интеграционные тесты
- `test_integration.py` - полные рабочие процессы

## Запуск тестов

### Все тесты
```bash
pytest
```

### Конкретные категории
```bash
# Только быстрые тесты
pytest -m "not slow"

# Только интеграционные тесты
pytest -m integration

# Только тесты производительности
pytest -m performance

# Только граничные случаи
pytest -m edge_case
```

### Конкретные файлы
```bash
# Только тесты архивов
pytest tests/test_archive_*.py

# Только базовые тесты
pytest tests/test_encoding_utils.py tests/test_file_utils.py
```

### С подробным выводом
```bash
pytest -v -s
```

## Покрытие тестов

### encoding_utils
- ✅ Определение BOM (UTF-8, UTF-16 LE/BE)
- ✅ Автоматическое определение кодировки через chardet
- ✅ Выбор минимальной подходящей кодировки
- ✅ Обработка ошибок кодировки

### file_utils
- ✅ Создание/удаление файлов и директорий
- ✅ Копирование файлов и папок
- ✅ Создание и распаковка архивов
- ✅ Изменение прав доступа (chmod)
- ✅ Листинг файлов (ls)
- ✅ Создание структуры папок (make)

### structures.Stream и File
- ✅ Операции потоков (`>`, `<`, `<<`, `>>`)
- ✅ Чтение/запись содержимого с автоопределением кодировки
- ✅ Перекодировка файлов
- ✅ Метаданные файлов (размер, время, скрытость)
- ✅ Свойства файлов (имя, расширение)

### structures.Dir
- ✅ Создание/перемещение/переименование директорий
- ✅ Навигация через оператор `/`
- ✅ Итерация по содержимому
- ✅ Метаданные директорий
- ✅ Управление скрытостью

### structures.Archive
- ✅ **Форматы**: zip, 7z, tar, tar.gz, tar.bz2, gz, bz2, rar
- ✅ **Операции**: создание, добавление, извлечение, просмотр
- ✅ **Пароли**: защита zip/7z архивов
- ✅ **Специальные символы**: кириллица, эмодзи, японский текст
- ✅ **Большие файлы**: до 10MB
- ✅ **Глубокая вложенность**: до 4 уровней
- ✅ **Граничные случаи**: длинные имена, Unicode, пустые папки
- ✅ **Производительность**: пакетные операции, потоковая обработка
- ✅ **Обработка ошибок**: несуществующие файлы, неправильные пароли

## Особенности тестирования

### Временные файлы
Все тесты используют `tmp_path` фикстуру pytest для создания временных файлов, которые автоматически очищаются после тестов.

### Параметризация
Многие тесты используют `@pytest.mark.parametrize` для тестирования всех поддерживаемых форматов архивов.

### Платформо-зависимые тесты
Некоторые тесты пропускаются на определенных платформах:
- Символические ссылки - только Unix
- Права доступа - только Unix
- Специальные символы Windows - только Windows

### Производительность
Тесты производительности измеряют время выполнения операций и выводят результаты для анализа.

## Требования

- Python 3.7+
- pytest
- chardet (для определения кодировок)
- py7zr (для 7z архивов)
- pyzipper (для защищенных zip архивов)
- rarfile (для rar архивов)

## Отладка

### Запуск с отладкой
```bash
pytest -v -s --pdb
```

### Логирование
```bash
pytest --log-cli-level=DEBUG
```

### Остановка на первой ошибке
```bash
pytest -x
```
